#!/usr/bin/python

def API_pulls(api_key, cryptocurrencies = [], etfs = [], stocks = [], interval = '1day'):
    '''
    Uses API key from twelvedata.com(Signup free and simple - 800 calls/day) collects time series data on various cryptocurrencies, etfs,
    and stocks N.B. need to have installed requests and pandas libraries
    :param api_key ~ string of user's api_key
    :param cryptocurrencies ~ list of stings for desired cryptocurrencies and correspoding denomination, for example:
                             "BTC/USD" or "ETH/BTC", default is empty string
    :param stocks ~ list of strings for desired stocks, for exmaple: "MSFT" or "TSLA", default is empty string
    :param etfs ~ list of strings for desired etfs, for example: "LIT" or "SMH", defailt is empty string
    :param interval ~ string stating the desired interval for data pulled, for more information on this syntax, explore
                      https://twelvedata.com/docs, default "1day"
    :return data ~ list of dictionaries created from pulling data, max len(3), one dictionary for each investment type
    '''
    import requests
    import pandas as pd

    #initializing empty list data to add dictionaries
    data = []

    #conditional on whether to add crypto_dict to data or pass
    if cryptocurrencies != []:

        #initializing crypto_dict
        crypto_dict = {}

        #for loop going through desired cryptos
        for crypto in cryptocurrencies:

            #More user friendly pull - will change based on investment type
            tik_crypto = crypto

            #API_url for crypto
            api_url_crypto = f'https://api.twelvedata.com/time_series?symbol={tik_crypto}&exchange=Binance&interval={interval}&apikey={api_key}'

            #getting data
            pull = requests.get(api_url_crypto).json()

            #storing it in dictionary for access
            crypto_dict[crypto] =  pd.DataFrame(pull['values'])

        #adding dict to data list
        data.append(crypto_dict)

    else:
        pass

    #conditional on whether to add etf_dict to data or pass
    if etfs != []:

        #initializing etf_dict
        etf_dict = {}

        #for loop goint through desired etfs
        for etf in etfs:

            tik_etf = etf

            #API_url for etf
            api_url_etf = f'https://api.twelvedata.com/time_series?symbol={tik_etf}&interval={interval}&apikey={api_key}'

            #getting data
            pull = requests.get(api_url_etf).json()

            #storing it in dictionary for access
            etf_dict[etf] = pd.DataFrame(pull['values'])

        #adding dict to data list
        data.append(etf_dict)

    else:
        pass

    #conditional on whether to add stock_dict to data
    if stocks != []:

        #initializing stock_dict
        stock_dict = {}

        #for loop going through desired stocks
        for stock in stocks:

            tik_stock = stock

            #API_url for stock
            api_url_stock = f'https://api.twelvedata.com/time_series?symbol={tik_stock}&interval={interval}&apikey={api_key}'

            #getting data
            pull = requests.get(api_url_stock).json()

            #storing it in dictionary for access
            stock_dict[stock] = pd.DataFrame(pull['values'])

        #adding dict to data list
        data.append(stock_dict)

    else:
        pass

    return data

'''
example :
API_pulls(api_key = 'your_Key', cryptocurrencies = ['BTC/USD','ETH/USD'], etfs = ['LIT','SMH'], stocks = ['AMD','NVDA'], interval = '1day')

[{'BTC/USD':       datetime         open         high          low        close
  0   2021-10-28  58434.37891  61719.76172  58107.26172  60155.55859
  1   2021-10-27  60310.32031  61444.89062  58096.05859  58431.16016
  2   2021-10-26  63077.67969  63272.51953  59916.48047  60307.67969
  3   2021-10-25  60854.07031  63696.21094  60655.53125  63060.78906
  4   2021-10-24  61285.48828  61466.25000  59522.85938  60868.64062
  5   2021-10-23  60688.73828  61729.98047  59733.44922  61310.78125
  6   2021-10-22  62202.35938  63700.48047  60068.12109  60690.30078
  7   2021-10-21  66001.39844  66602.81250  62088.00000  62198.05859
  8   2021-10-20  64268.39844  66973.64062  63540.14844  65961.00781
  9   2021-10-19  62008.41016  64449.39844  61431.73828  64275.53906
  10  2021-10-18  61528.32812  62625.73047  60053.23047  62024.35938
  11  2021-10-17  60875.76953  61659.98828  59156.71875  61526.00000
  12  2021-10-16  61720.00000  62332.91016  60160.28906  60860.85938
  13  2021-10-15  57344.98828  62913.03906  56870.96875  61659.76953
  14  2021-10-14  57370.83984  58513.32812  56858.10938  57340.96875
  15  2021-10-13  56002.92188  57697.83984  54320.01172  57382.64844
  16  2021-10-12  57425.75000  57644.30078  54172.69922  56022.44141
  17  2021-10-11  54652.17969  57819.28906  54456.96875  57477.01172
  18  2021-10-10  54949.19141  56435.03906  54089.83984  54685.64844
  19  2021-10-09  53947.82031  55429.21875  53704.85938  54939.03906
  20  2021-10-08  53787.07031  55955.44141  53653.42188  53911.19922
  21  2021-10-07  55311.12891  55311.12891  53491.23828  53779.80078
  22  2021-10-06  51457.39844  55658.55078  50436.57812  55315.89062
  23  2021-10-05  49222.44922  51864.23047  49056.35156  51456.10938
  24  2021-10-04  48198.76172  49473.73047  46960.01172  49227.46875
  25  2021-10-03  47632.28906  49159.00000  47122.19141  48186.67188
  26  2021-10-02  48136.82031  48300.00000  47443.78125  47665.48828
  27  2021-10-01  43816.23047  48430.80859  43289.26953  48141.12109
  28  2021-09-30  41541.07031  44102.01172  41414.14062  43822.50000
  29  2021-09-29  41019.66016  42561.07031  40816.98828  41535.57812,
  'ETH/USD':       datetime        open        high         low       close
  0   2021-10-28  3923.58008  4230.85986  3895.90991  4178.37988
  1   2021-10-27  4130.52002  4300.31006  3914.21997  3921.71997
  2   2021-10-26  4225.62988  4292.35010  4098.35010  4129.68994
  3   2021-10-25  4084.10010  4235.25000  4069.91992  4220.35010
  4   2021-10-24  4171.99023  4183.97998  3965.55005  4083.17993
  5   2021-10-23  3971.48999  4168.77979  3938.36011  4168.77979
  6   2021-10-22  4053.34009  4163.97021  3896.16992  3970.89990
  7   2021-10-21  4161.79004  4365.70020  4028.35010  4054.14990
  8   2021-10-20  3882.64990  4168.39990  3830.31006  4160.20996
  9   2021-10-19  3745.28003  3884.22998  3733.81006  3876.70996
  10  2021-10-18  3849.34009  3892.36011  3685.35010  3747.62012
  11  2021-10-17  3829.46997  3917.62012  3666.11011  3844.62988
  12  2021-10-16  3872.67993  3967.72998  3804.45996  3828.25000
  13  2021-10-15  3790.94995  3906.54004  3735.10010  3868.98999
  14  2021-10-14  3609.00000  3819.81006  3588.19995  3790.17993
  15  2021-10-13  3490.76001  3611.83008  3415.44995  3607.20996
  16  2021-10-12  3541.35010  3544.87988  3404.63989  3489.00000
  17  2021-10-11  3413.29004  3622.88989  3382.58008  3545.08008
  18  2021-10-10  3573.88989  3599.22998  3409.25000  3414.71997
  19  2021-10-09  3564.98999  3630.33008  3542.00000  3574.22998
  20  2021-10-08  3586.68994  3668.13989  3537.93994  3559.23999
  21  2021-10-07  3575.38989  3649.63989  3473.54004  3586.92993
  22  2021-10-06  3514.93994  3627.08008  3345.56006  3575.58008
  23  2021-10-05  3386.14990  3540.83008  3364.83008  3517.82007
  24  2021-10-04  3417.06006  3436.12988  3272.33008  3383.16992
  25  2021-10-03  3390.73999  3485.00000  3347.32007  3416.17993
  26  2021-10-02  3310.93994  3468.30005  3258.28003  3388.26001
  27  2021-10-01  2998.45996  3328.73999  2972.90991  3309.58008
  28  2021-09-30  2849.34009  3047.00000  2837.55005  2999.86011
  29  2021-09-29  2803.84009  2949.06006  2785.63989  2851.71997},
 {'LIT':       datetime      open      high       low     close   volume
  0   2021-10-28  90.11000  91.17970  89.52500  91.16000  1399533
  1   2021-10-27  90.52000  91.79990  90.00500  90.17000   934647
  2   2021-10-26  91.26000  91.34500  89.81000  90.54000  1291158
  3   2021-10-25  87.85000  91.43000  87.85000  91.27000  1533170
  4   2021-10-22  88.11000  88.99000  87.56550  87.88500   775116
  5   2021-10-21  87.82000  88.88000  87.40000  88.10000   773008
  6   2021-10-20  89.01500  89.15000  88.35000  88.89000   692158
  7   2021-10-19  88.36000  89.57850  88.25810  88.70000  1273490
  8   2021-10-18  86.86500  88.70000  86.78850  88.38500  1140253
  9   2021-10-15  84.73000  86.24000  84.73000  85.81000   931630
  10  2021-10-14  84.15000  84.75000  83.78000  84.75000   771560
  11  2021-10-13  82.41000  84.20000  82.41000  84.15000  1160942
  12  2021-10-12  80.76000  80.96000  80.01000  80.40000   550043
  13  2021-10-11  80.79000  81.65000  80.67000  80.76000   434804
  14  2021-10-08  81.70000  81.70000  80.01000  80.24000   477930
  15  2021-10-07  80.04000  82.23000  80.04000  81.67000   548880
  16  2021-10-06  81.12000  81.12000  78.56000  80.05000   713135
  17  2021-10-05  80.25000  81.42470  79.90010  81.06000   687422
  18  2021-10-04  81.33000  81.33000  78.58000  78.64000  1078980
  19  2021-10-01  81.55000  81.82590  80.24000  81.34000   583533
  20  2021-09-30  79.73000  83.30000  79.73000  81.96000   616623
  21  2021-09-29  80.36000  80.65000  79.67000  79.71000   521944
  22  2021-09-28  81.47000  81.47000  79.94000  80.35000   994771
  23  2021-09-27  83.09000  83.18000  82.39500  83.05000   703799
  24  2021-09-24  83.26000  83.38310  82.53000  83.05000   494131
  25  2021-09-23  82.52000  83.85000  82.52000  83.65000   558569
  26  2021-09-22  81.64990  83.18000  81.60000  82.42000   714927
  27  2021-09-21  79.99000  81.02500  79.83410  80.77500   863964
  28  2021-09-20  80.39000  80.57500  78.67100  79.53000  1461890
  29  2021-09-17  84.00000  84.06000  82.90000  83.46000   792367,
  'SMH':       datetime       open       high        low      close   volume
  0   2021-10-28  270.69000  272.81000  270.03000  272.00000  2348558
  1   2021-10-27  268.48001  270.95999  267.31000  267.76001  3893935
  2   2021-10-26  271.54001  272.73001  269.06000  270.04001  2437204
  3   2021-10-25  268.37000  270.09000  267.37000  268.45001  1851321
  4   2021-10-22  269.20001  271.57001  266.70001  267.16000  2957060
  5   2021-10-21  264.70999  269.66501  264.47000  269.63000  1886301
  6   2021-10-20  266.98001  267.91000  265.54999  266.50000  2198421
  7   2021-10-19  265.01001  267.67999  264.17001  267.67999  2290844
  8   2021-10-18  260.57001  264.76999  259.62500  264.64999  1802895
  9   2021-10-15  262.45999  262.82001  261.00000  262.57999  2537635
  10  2021-10-14  258.36499  260.56000  257.03000  260.45001  3481771
  11  2021-10-13  252.91000  254.03500  251.66000  252.81000  2824699
  12  2021-10-12  254.72000  255.27000  249.62000  250.67000  3945273
  13  2021-10-11  253.46001  257.29001  253.16000  253.23000  2180775
  14  2021-10-08  258.39999  258.48999  254.34000  254.75000  2257038
  15  2021-10-07  257.67999  260.25000  257.01001  257.25000  2418619
  16  2021-10-06  250.25000  254.38000  249.67000  254.09000  3661851
  17  2021-10-05  251.81000  255.12000  250.64000  253.32001  3215201
  18  2021-10-04  254.56000  254.96001  248.78000  249.81000  4673081
  19  2021-10-01  257.48080  257.64999  252.35001  256.28000  3647329
  20  2021-09-30  258.20001  260.53000  256.25000  256.26999  3257411
  21  2021-09-29  260.66000  261.67999  255.77000  256.56000  4756960
  22  2021-09-28  265.64999  267.51001  260.17001  260.48999  5458685
  23  2021-09-27  269.72000  272.38000  267.70999  271.42001  1932804
  24  2021-09-24  270.98999  272.84000  270.41000  272.39001  1340638
  25  2021-09-23  271.48001  273.91000  270.07999  273.13000  2209526
  26  2021-09-22  266.37000  270.42001  265.52200  269.76001  2435887
  27  2021-09-21  266.37479  266.79999  262.87000  264.95999  2277672
  28  2021-09-20  265.00000  266.20001  260.44000  264.39999  3847364
  29  2021-09-17  274.75000  274.79001  269.97000  271.00000  3592454},
 {'AMD':       datetime       open       high        low      close    volume
  0   2021-10-28  122.80010  123.50000  120.26000  120.63000  48675358
  1   2021-10-27  121.63000  128.08000  121.05000  122.28000  98179700
  2   2021-10-26  122.99000  127.20000  122.58000  122.93000  59128300
  3   2021-10-25  120.51500  123.45990  118.60000  122.36000  47471612
  4   2021-10-22  120.83000  121.56000  118.37000  119.82000  38932100
  5   2021-10-21  116.50000  119.50000  116.26000  119.33740  32136695
  6   2021-10-20  116.29000  118.30000  115.42000  116.39000  34208800
  7   2021-10-19  116.19000  117.17000  114.47000  116.32000  38602148
  8   2021-10-18  111.90000  116.88000  111.37000  116.43000  47396916
  9   2021-10-15  112.51000  112.84000  111.11000  112.12000  34177700
  10  2021-10-14  110.50000  112.22000  109.63000  111.99000  46855200
  11  2021-10-13  106.28000  109.88000  106.25000  109.16000  55535400
  12  2021-10-12  105.16500  106.04000  104.34000  105.04000  34039906
  13  2021-10-11  104.62000  107.20000  104.02000  104.68000  31251500
  14  2021-10-08  106.55000  107.28000  104.89000  105.06000  30584900
  15  2021-10-07  104.60000  107.95000  104.46000  106.45000  41543100
  16  2021-10-06  100.45000  103.72000  100.35000  103.64000  39071700
  17  2021-10-05  100.92000  102.87000  100.61000  101.81000  31455200
  18  2021-10-04  101.74000  101.85000   99.82000  100.34000  41967100
  19  2021-10-01  102.60000  103.00000  100.64000  102.45000  41491600
  20  2021-09-30  102.08000  104.44000  101.99000  102.90000  57588500
  21  2021-09-29  102.30000  102.66000   99.81000  100.35000  52224700
  22  2021-09-28  106.84000  107.65000  101.42000  101.52000  74469000
  23  2021-09-27  105.07000  108.44000  103.44000  108.16000  51944300
  24  2021-09-24  105.19000  106.05000  104.68000  105.80000  26482600
  25  2021-09-23  104.89000  106.86000  103.89000  106.15000  32816700
  26  2021-09-22  102.82000  104.56000  102.21000  104.38000  34126300
  27  2021-09-21  102.15000  103.43000  101.18000  102.82000  35481500
  28  2021-09-20  101.58000  102.51000   99.51000  101.55000  45228400
  29  2021-09-17  105.56000  105.98000  103.71000  103.88000  44528300,
  'NVDA':       datetime       open       high        low      close    volume
  0   2021-10-28  248.85001  248.96001  245.23000  247.44000  17192006
  1   2021-10-27  244.74001  250.89999  242.82001  244.50999  24542600
  2   2021-10-26  239.89000  252.59000  239.24001  247.17000  48531100
  3   2021-10-25  229.73000  233.53999  227.70200  231.66000  23023483
  4   2021-10-22  228.23000  231.30000  225.61000  227.25999  24893400
  5   2021-10-21  220.97000  227.11000  220.83000  226.86000  16901153
  6   2021-10-20  223.05000  224.33000  219.82001  221.03000  14613500
  7   2021-10-19  222.88000  223.78000  220.37000  222.94000  15002418
  8   2021-10-18  217.49001  222.89999  216.45200  222.22000  18621718
  9   2021-10-15  218.10001  219.31000  216.62000  218.62000  22679500
  10  2021-10-14  212.88000  217.55000  211.22000  217.46001  24316900
  11  2021-10-13  209.17999  209.89999  207.13000  209.39000  18023700
  12  2021-10-12  208.27499  210.57001  205.28000  206.71001  15853118
  13  2021-10-11  205.75000  210.63000  205.11000  206.95000  16338754
  14  2021-10-08  211.00999  212.06000  207.75000  208.31000  15102500
  15  2021-10-07  210.92000  213.22000  209.72000  210.75000  25642800
  16  2021-10-06  201.20000  207.20000  200.80000  207.00000  29720175
  17  2021-10-05  199.50000  206.48000  198.53999  204.50999  27867294
  18  2021-10-04  205.03999  205.41789  195.55000  197.32001  34563497
  19  2021-10-01  207.50000  208.58000  202.03000  207.42000  24097796
  20  2021-09-30  207.68401  210.66000  206.88000  207.16000  21670219
  21  2021-09-29  209.39999  210.17000  204.67000  205.17000  21800500
  22  2021-09-28  212.13499  214.10001  206.50999  206.99001  34306895
  23  2021-09-27  217.10001  217.99001  213.25000  216.60001  24487700
  24  2021-09-24  220.70000  221.49001  218.61000  220.81000  21735900
  25  2021-09-23  221.39999  225.35001  218.89999  224.82001  24855500
  26  2021-09-22  213.66000  219.60001  211.96001  219.41000  26872600
  27  2021-09-21  214.17000  214.25000  209.50000  212.46001  20468800
  28  2021-09-20  211.46001  214.33000  206.62000  211.13000  34944000
  29  2021-09-17  223.00000  223.21001  218.30000  219.00000  29159400}]

  This then can be sliced in different ways to get desired data, or
  intervals can be changed for specific time time_series
  ''' 
